<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1" />
<meta name="generator" content="pdoc 0.10.0" />
<title>blind_llama.request_adapters API documentation</title>
<meta name="description" content="This module implements a set of requests TransportAdapter, PoolManager,
ConnectionPool and HTTPSConnection with one goal only: â€¦" />
<link rel="preload stylesheet" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/10up-sanitize.css/11.0.1/sanitize.min.css" integrity="sha256-PK9q560IAAa6WVRRh76LtCaI8pjTJ2z11v0miyNNjrs=" crossorigin>
<link rel="preload stylesheet" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/10up-sanitize.css/11.0.1/typography.min.css" integrity="sha256-7l/o7C8jubJiy74VsKTidCy1yBkRtiUGbVkYBylBqUg=" crossorigin>
<style>:root{--highlight-color:#142540}.flex{display:flex !important}body{line-height:1.5em}#content{padding:20px}#sidebar{padding:30px;overflow:hidden}#sidebar > *:last-child{margin-bottom:2cm}.http-server-breadcrumbs{font-size:130%;margin:0 0 15px 0}#footer{font-size:.75em;padding:5px 30px;border-top:1px solid #ddd;text-align:right}#footer p{margin:0 0 0 1em;display:inline-block}#footer p:last-child{margin-right:30px}h1,h2,h3,h4,h5{font-weight:300}h1{font-size:2.5em;line-height:1.1em}h2{font-size:1.75em;margin:1em 0 .50em 0}h3{font-size:1.4em;margin:25px 0 10px 0}h4{margin:0;font-size:105%}h1:target,h2:target,h3:target,h4:target,h5:target,h6:target{background:var(--highlight-color);padding:.2em 0}a{color:#b3c6e5;text-decoration:none}a:hover{color:#647693}.title code{font-weight:bold}h2[id^="header-"]{margin-top:2em}.ident{color:#f0ba2d}pre code{background:transparent;font-size:.8em;line-height:1.4em}code{background:transparent;padding:1px 4px;overflow-wrap:break-word}h1 code{background:transparent}pre{border:0;border-top:1px solid #ccc;border-bottom:1px solid #ccc;margin:1em 0;padding:1ex}#http-server-module-list{display:flex;flex-flow:column}#http-server-module-list div{display:flex}#http-server-module-list dt{min-width:10%}#http-server-module-list p{margin-top:0}.toc ul,#index{list-style-type:none;margin:0;padding:0}#index code{background:transparent}#index h3{border-bottom:1px solid #ddd}#index ul{padding:0}#index h4{margin-top:.6em;font-weight:bold}*/ @media (min-width:200ex){#index .two-column{column-count:2}}@media (min-width:300ex){#index .two-column{column-count:3}}*/
dl{margin-bottom:2em}dl dl:last-child{margin-bottom:4em}dd{margin:0 0 1em 3em}#header-classes + dl > dd{margin-bottom:3em}dd dd{margin-left:2em}dd p{margin:10px 0}.name{background:#111;font-weight:bold;font-size:.85em;padding:5px 10px;display:inline-block;min-width:40%}.name:hover{background:#171717}dt:target .name{background:var(--highlight-color)}.name > span:first-child{white-space:nowrap}.name.class > span:nth-child(2){margin-left:.4em}.inherited{color:#999;border-left:5px solid #eee;padding-left:1em}.inheritance em{font-style:normal;font-weight:bold}.desc h2{font-weight:400;font-size:1.25em}.desc h3{font-size:1em}.desc dt code{background:transparent}.source summary,.git-link-div{color:#666;text-align:right;font-weight:400;font-size:.8em;text-transform:uppercase}.source summary > *{white-space:nowrap;cursor:pointer}.git-link{color:inherit;margin-left:1em}.source pre{max-height:500px;overflow:auto;margin:0}.source pre code{font-size:12px;overflow:visible}.hlist{list-style:none}.hlist li{display:inline}.hlist li:after{content:',\2002'}.hlist li:last-child:after{content:none}.hlist .hlist{display:inline;padding-left:1em}img{max-width:100%}td{padding:0 .5em}.admonition{padding:.1em .5em;margin-bottom:1em}.admonition-title{font-weight:bold}.admonition.note,.admonition.info,.admonition.important{background:#1ef}.admonition.todo,.admonition.versionadded,.admonition.tip,.admonition.hint{background:#1fd}.admonition.warning,.admonition.versionchanged,.admonition.deprecated{background:#1d4}.admonition.error,.admonition.danger,.admonition.caution{background:darkpink}</style>
<style media="screen and (min-width: 700px)">@media screen and (min-width:700px){#sidebar{width:25%;height:100vh;overflow:auto;position:sticky;top:0}#content{width:70%;max-width:100ch;padding:3em 4em;border-left:1px solid #ddd}::-webkit-scrollbar{width:12px}::-webkit-scrollbar-track{background:#252525}::-webkit-scrollbar-thumb{background-color:#505050;border-radius:20px;border:3px solid #252525}pre code{font-size:1em}.item .name{font-size:1em}main{display:flex;flex-direction:row-reverse;justify-content:flex-end;background:#202023;color:#ffffff}.toc ul ul,#index ul{padding-left:1.5em}.toc > ul > li{margin-top:.5em}}</style>
<style media="print">@media print{#sidebar h1{page-break-before:always}.source{display:none}}@media print{*{background:transparent !important;color:#000 !important;box-shadow:none !important;text-shadow:none !important}a[href]:after{content:" (" attr(href) ")";font-size:90%}a[href][title]:after{content:none}abbr[title]:after{content:" (" attr(title) ")"}.ir a:after,a[href^="javascript:"]:after,a[href^="#"]:after{content:""}pre,blockquote{border:1px solid #999;page-break-inside:avoid}thead{display:table-header-group}tr,img{page-break-inside:avoid}img{max-width:100% !important}@page{margin:0.5cm}p,h2,h3{orphans:3;widows:3}h1,h2,h3,h4,h5,h6{page-break-after:avoid}}</style>
<link rel="icon" href="/assets/logo.png">
<style>.homelink{display:block;font-size:2em;font-weight:bold;padding-bottom:.5em;border-bottom:1px solid silver}.homelink:hover{color:f0ba2d}.homelink img{max-width:20%;max-height:5em;margin:auto;margin-bottom:.3em}</style>
<script type="text/javascript">
(function(window, document, dataLayerName, id) {
window[dataLayerName]=window[dataLayerName]||[],window[dataLayerName].push({start:(new Date).getTime(),event:"stg.start"});var scripts=document.getElementsByTagName('script')[0],tags=document.createElement('script');
function stgCreateCookie(a,b,c){var d="";if(c){var e=new Date;e.setTime(e.getTime()+24*c*60*60*1e3),d="; expires="+e.toUTCString()}document.cookie=a+"="+b+d+"; path=/"}
var isStgDebug=(window.location.href.match("stg_debug")||document.cookie.match("stg_debug"))&&!window.location.href.match("stg_disable_debug");stgCreateCookie("stg_debug",isStgDebug?1:"",isStgDebug?14:-1);
var qP=[];dataLayerName!=="dataLayer"&&qP.push("data_layer_name="+dataLayerName),isStgDebug&&qP.push("stg_debug");var qPString=qP.length>0?("?"+qP.join("&")):"";
tags.async=!0,tags.src="https://mithrilsecurity.containers.piwik.pro/"+id+".js"+qPString,scripts.parentNode.insertBefore(tags,scripts);
!function(a,n,i){a[n]=a[n]||{};for(var c=0;c<i.length;c++)!function(i){a[n][i]=a[n][i]||{},a[n][i].api=a[n][i].api||function(){var a=[].slice.call(arguments,0);"string"==typeof a[0]&&window[dataLayerName].push({event:n+"."+i+":"+a[0],parameters:[].slice.call(arguments,1)})}}(i[c])}(window,"ppms",["tm","cm"]);
})(window, document, 'dataLayer', '82244d82-e27f-4f0e-bb2f-c94a190fd5ab');
</script>
<!-- Google Tag Manager -->
<script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
'https://www.googletagmanager.com/gtm.js?id=%27+i+dl;f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','GTM-TVD93MF');</script>
<!-- End Google Tag Manager -->
</head>
<body>
<main>
<article id="content">
<header>
<h1 class="title">Module <code>blind_llama.request_adapters</code></h1>
</header>
<section id="section-intro">
<p>This module implements a set of requests TransportAdapter, PoolManager,
ConnectionPool and HTTPSConnection with one goal only:</p>
<ul>
<li>to use a specific IP address when connecting via SSL to a web service without
running into SNI trouble.</li>
</ul>
<p>The usual technique to force an IP address on an HTTP connection with Requests
is (assuming I want <a href="http://example.com/some/path">http://example.com/some/path</a> on IP 1.2.3.4):</p>
<p>requests.get("http://1.2.3.4/some/path", headers={'Host': 'example.com'})</p>
<p>this is useful if I want to specifically test how 1.2.3.4 is responding; for
instance, if example.com is DNS round-robined to several IP
addresses and I want to hit one of them specifically.</p>
<p>This also works for https requests if using Python &lt;2.7.9 because older
versions don't do SNI and thus don't pass the requested hostname as part of the
SSL handshake.</p>
<p>However, Python &gt;=2.7.9 and &gt;=3.4.x conveniently added SNI support, breaking
this way of connecting to the IP, because the IP address embedded in the URL
<em>is</em> passed as part of the SSL handshake, causing errors (mainly, the server
returns a 400 Bad Request because the SNI host 1.2.3.4 doesn't match the one in
the HTTP headers example.com).</p>
<p>The "easiest" way to achieve this is to force the IP address at the lowest
possible level, namely when we do socket.create_connection. The rest of the
"stack" is given the actual hostname. So the sequence is:</p>
<p>1- Open a socket to 1.2.3.4
2- SSL wrap this socket using the hostname.
3- Do the rest of the HTTPS traffic, headers and all over this socket.</p>
<p>Unfortunately Requests hides the socket.create_connection call in the deep
recesses of urllib3, so the specified chain of classes is needed to propagate
the given dest_ip value all the way down the stack.</p>
<p>Because this applies to a very limited set of circumstances, the overridden
code is very simplistic and eschews many of the nice checks Requests does for
you.</p>
<p>Specifically:</p>
<ul>
<li>It ONLY handles HTTPS.</li>
<li>It does NO certificate verification (which would be pointless)</li>
<li>Only tested with Requests 2.2.1 and 2.9.1.</li>
<li>Does NOT work with the ancient urllib3 (1.7.1) shipped with Ubuntu 14.04.
Should not be an issue because Ubunt 14.04 has older Python which doesn't do
SNI.</li>
</ul>
<h1 id="how-to-use-it">How to use it</h1>
<p>It's like any other transport adapter. Just pass the IP address that
connections to the given URL prefix should use.</p>
<p>session = requests.Session()
session.mount("https://example.com", ForcedIPHTTPSAdapter(dest_ip='1.2.3.4'))
response = session.get(
'/some/path', headers={'Host': 'example.com'}, verify=False)</p>
</section>
<section>
</section>
<section>
</section>
<section>
</section>
<section>
<h2 class="section-title" id="header-classes">Classes</h2>
<dl>
<dt id="blind_llama.request_adapters.ForcedIPHTTPSAdapter"><code class="flex name class">
<span>class <span class="ident">ForcedIPHTTPSAdapter</span></span>
<span>(</span><span>*args, **kwargs)</span>
</code></dt>
<dd>
<div class="desc"><p>The built-in HTTP Adapter for urllib3.</p>
<p>Provides a general-case interface for Requests sessions to contact HTTP and
HTTPS urls by implementing the Transport Adapter interface. This class will
usually be created by the :class:<code>Session &lt;Session&gt;</code> class under the
covers.</p>
<p>:param pool_connections: The number of urllib3 connection pools to cache.
:param pool_maxsize: The maximum number of connections to save in the pool.
:param max_retries: The maximum number of retries each connection
should attempt. Note, this applies only to failed DNS lookups, socket
connections and connection timeouts, never to requests where data has
made it to the server. By default, Requests does not retry failed
connections. If you need granular control over the conditions under
which we retry a request, import urllib3's <code>Retry</code> class and pass
that instead.
:param pool_block: Whether the connection pool should block for connections.</p>
<p>Usage::</p>
<blockquote>
<blockquote>
<blockquote>
<p>import requests
s = requests.Session()
a = requests.adapters.HTTPAdapter(max_retries=3)
s.mount('http://', a)</p>
</blockquote>
</blockquote>
</blockquote></div>
<h3>Ancestors</h3>
<ul class="hlist">
<li>requests.adapters.HTTPAdapter</li>
<li>requests.adapters.BaseAdapter</li>
</ul>
<h3>Methods</h3>
<dl>
<dt id="blind_llama.request_adapters.ForcedIPHTTPSAdapter.init_poolmanager"><code class="name flex">
<span>def <span class="ident">init_poolmanager</span></span>(<span>self, *args, **pool_kwargs)</span>
</code></dt>
<dd>
<div class="desc"><p>Initializes a urllib3 PoolManager.</p>
<p>This method should not be called from user code, and is only
exposed for use when subclassing the
:class:<code>HTTPAdapter &lt;requests.adapters.HTTPAdapter&gt;</code>.</p>
<p>:param connections: The number of urllib3 connection pools to cache.
:param maxsize: The maximum number of connections to save in the pool.
:param block: Block when no free connections are available.
:param pool_kwargs: Extra keyword arguments used to initialize the Pool Manager.</p></div>
</dd>
</dl>
</dd>
<dt id="blind_llama.request_adapters.ForcedIPHTTPSConnection"><code class="flex name class">
<span>class <span class="ident">ForcedIPHTTPSConnection</span></span>
<span>(</span><span>*args, **kwargs)</span>
</code></dt>
<dd>
<div class="desc"><p>Many of the parameters to this constructor are passed to the underlying SSL
socket by means of :py:func:<code>urllib3.util.ssl_wrap_socket</code>.</p></div>
<h3>Ancestors</h3>
<ul class="hlist">
<li>urllib3.connection.HTTPSConnection</li>
<li>urllib3.connection.HTTPConnection</li>
<li>http.client.HTTPConnection</li>
</ul>
</dd>
<dt id="blind_llama.request_adapters.ForcedIPHTTPSConnectionPool"><code class="flex name class">
<span>class <span class="ident">ForcedIPHTTPSConnectionPool</span></span>
<span>(</span><span>*args, **kwargs)</span>
</code></dt>
<dd>
<div class="desc"><p>Same as :class:<code>.HTTPConnectionPool</code>, but HTTPS.</p>
<p>:class:<code>.HTTPSConnection</code> uses one of <code>assert_fingerprint</code>,
<code>assert_hostname</code> and <code>host</code> in this order to verify connections.
If <code>assert_hostname</code> is False, no verification is done.</p>
<p>The <code>key_file</code>, <code>cert_file</code>, <code>cert_reqs</code>, <code>ca_certs</code>,
<code>ca_cert_dir</code>, <code>ssl_version</code>, <code>key_password</code> are only used if :mod:<code>ssl</code>
is available and are fed into :meth:<code>urllib3.util.ssl_wrap_socket</code> to upgrade
the connection socket into an SSL socket.</p></div>
<h3>Ancestors</h3>
<ul class="hlist">
<li>urllib3.connectionpool.HTTPSConnectionPool</li>
<li>urllib3.connectionpool.HTTPConnectionPool</li>
<li>urllib3.connectionpool.ConnectionPool</li>
<li>urllib3._request_methods.RequestMethods</li>
</ul>
</dd>
<dt id="blind_llama.request_adapters.ForcedIPHTTPSPoolManager"><code class="flex name class">
<span>class <span class="ident">ForcedIPHTTPSPoolManager</span></span>
<span>(</span><span>*args, **kwargs)</span>
</code></dt>
<dd>
<div class="desc"><p>Allows for arbitrary requests while transparently keeping track of
necessary connection pools for you.</p>
<p>:param num_pools:
Number of connection pools to cache before discarding the least
recently used pool.</p>
<p>:param headers:
Headers to include with all requests, unless other headers are given
explicitly.</p>
<p>:param **connection_pool_kw:
Additional parameters are used to create fresh
:class:<code>urllib3.connectionpool.ConnectionPool</code> instances.</p>
<p>Example:</p>
<p>.. code-block:: python</p>
<pre><code>import urllib3

http = urllib3.PoolManager(num_pools=2)

resp1 = http.request("GET", "https://google.com/")
resp2 = http.request("GET", "https://google.com/mail")
resp3 = http.request("GET", "https://yahoo.com/")

print(len(http.pools))
# 2
</code></pre></div>
<h3>Ancestors</h3>
<ul class="hlist">
<li>urllib3.poolmanager.PoolManager</li>
<li>urllib3._request_methods.RequestMethods</li>
</ul>
</dd>
</dl>
</section>
</article>
<nav id="sidebar">
<header>
<a class="homelink" rel="home" title="blindllama Home" href="https://mithrilsecurity.io">
<img style="max-width: 225px; max-height: 150px" src="https://raw.githubusercontent.com/mithril-security/blindbox/main/docs/assets/logo.png" alt=""> BlindAI
</a>
</header>
<h1>Index</h1>
<div class="toc">
<ul>
<li><a href="#how-to-use-it">How to use it</a></li>
</ul>
</div>
<ul id="index">
<li><h3>Super-module</h3>
<ul>
<li><code><a title="blind_llama" href="index.html">blind_llama</a></code></li>
</ul>
</li>
<li><h3><a href="#header-classes">Classes</a></h3>
<ul>
<li>
<h4><code><a title="blind_llama.request_adapters.ForcedIPHTTPSAdapter" href="#blind_llama.request_adapters.ForcedIPHTTPSAdapter">ForcedIPHTTPSAdapter</a></code></h4>
<ul class="">
<li><code><a title="blind_llama.request_adapters.ForcedIPHTTPSAdapter.init_poolmanager" href="#blind_llama.request_adapters.ForcedIPHTTPSAdapter.init_poolmanager">init_poolmanager</a></code></li>
</ul>
</li>
<li>
<h4><code><a title="blind_llama.request_adapters.ForcedIPHTTPSConnection" href="#blind_llama.request_adapters.ForcedIPHTTPSConnection">ForcedIPHTTPSConnection</a></code></h4>
</li>
<li>
<h4><code><a title="blind_llama.request_adapters.ForcedIPHTTPSConnectionPool" href="#blind_llama.request_adapters.ForcedIPHTTPSConnectionPool">ForcedIPHTTPSConnectionPool</a></code></h4>
</li>
<li>
<h4><code><a title="blind_llama.request_adapters.ForcedIPHTTPSPoolManager" href="#blind_llama.request_adapters.ForcedIPHTTPSPoolManager">ForcedIPHTTPSPoolManager</a></code></h4>
</li>
</ul>
</li>
</ul>
</nav>
</main>
<footer id="footer">
</footer>
</body>
</html>